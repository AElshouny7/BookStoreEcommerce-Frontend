<section class="admin-section">
  <h2>Products</h2>

  <form [formGroup]="form" (ngSubmit)="save()" class="grid">
    <div class="field">
      <label for="title">Title</label>
      <input id="title" type="text" formControlName="title" placeholder="Book title" />
    </div>

    <div class="field">
      <label for="imageURL">Image URL</label>
      <input id="imageURL" type="text" formControlName="imageURL" placeholder="https://…" />
    </div>

    <div class="field">
      <label for="price">Price</label>
      <input id="price" type="number" formControlName="price" min="0" step="0.01" />
    </div>

    <div class="field span-2">
      <label for="description">Description</label>
      <textarea
        id="description"
        rows="3"
        formControlName="description"
        placeholder="Short description"
      ></textarea>
    </div>

    <div class="field">
      <label for="stockQuantity">Stock Quantity</label>
      <input id="stockQuantity" type="number" formControlName="stockQuantity" min="0" />
    </div>

    <div class="field">
      <label for="categoryId">Category</label>
      @if (categories$ | async; as categories) {
      <select id="categoryId" formControlName="categoryId">
        <option [ngValue]="null" disabled selected>Select a category</option>
        @for (c of categories; track c.id) {
        <option [ngValue]="c.id">{{ c.name }}</option>
        }
      </select>
      } @else {
      <div class="muted">Loading categories…</div>
      }
    </div>

    <div class="actions">
      <button type="submit">{{ editingId ? 'Update' : 'Add' }}</button>
      <button type="button" (click)="clearForm()">Clear</button>
    </div>
  </form>

  <hr />

  @if (loading) {
  <p>Loading...</p>
  } @else {
  <ul>
    @for (p of products; track p.id) {
    <li>
      <b>{{ p.title }}</b> – {{ p.price | currency : ' EGP' }}
      <button (click)="edit(p)">Edit</button>
      <button (click)="delete(p.id)">Delete</button>
    </li>
    }
  </ul>
  }
</section>
